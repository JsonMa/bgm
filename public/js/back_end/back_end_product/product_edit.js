$(function(){var e={init:function(){this.bindEvent()},bindEvent:function(){$(".upload-img").click(function(){var o=$(this),t=o.attr("series"),r="";r="pump"==t?"/upload/product?series=pump":"/upload/product?series=seal";var i=new IOT.Dialog({title:"产品图片上传",content:'<div class="row"><form class="col-md-offset-1 col-md-10"><div class="form-group"><label for="fileInput" class="control-label">上传图片：(宽、高比例为1.5:1，参考值为：700像素x469像素)</label><div class="control-label"><div id="zyupload" class="zyupload"></div>  </div></div></form></div>',beforeClose:function(){return!1},showClose:!0,className:"",cache:!1,showOk:!1,okText:"取消",okCallback:function(){},showCancel:!0,cancelText:"保存",cancelCallback:function(){i.close()}});i.open(function(){e.imageUploader(r,function(e){var o=$.parseJSON(e);$(".response-img").empty(),$("<img src='"+o.imgPath[0].replace("public","..")+"' style='border: 1px solid #eee; max-width: 400px; max-height: 300px'/>").appendTo($(".response-img")),$("#product-img").val(o.imgPath[0])})})}),$(".upload-struct-img").click(function(){var o=$(this),t=o.attr("series"),r="";r="pump"==t?"/upload/product?series=pump":"/upload/product?series=seal";var i=new IOT.Dialog({title:"产品结构图上传",content:'<div class="row"><form class="col-md-offset-1 col-md-10"><div class="form-group"><label for="fileInput" class="control-label">上传图片：(宽、高比例为1.5:1，参考值为：700像素x469像素)</label><div class="control-label"><div id="zyupload" class="zyupload"></div>  </div></div></form></div>',beforeClose:function(){return!1},showClose:!0,className:"",cache:!1,showOk:!1,okText:"取消",okCallback:function(){},showCancel:!0,cancelText:"保存",cancelCallback:function(){i.close()}});i.open(function(){e.imageUploader(r,function(e){var o=$.parseJSON(e);$(".response-struct-img").empty(),$("<img src='"+o.imgPath[0].replace("public","..")+"' style='border: 1px solid #eee; max-width: 400px; max-height: 300px'/>").appendTo($(".response-struct-img")),$("#product-struct-img").val(o.imgPath[0])})})}),$(".product-form")[0]&&$(".product-form").parsley().on("form:submit",function(){var e=$("#product-img").val(),o=$(".product-form").attr("series");if(e){if("pump"==o)var t="/product/add_pump";else var t="/product/add_seal";var r=$(".product-form").serialize();return $.ajax({type:"GET",url:t,data:r,dataType:"json",success:function(e){0==e.code?(IOT.tips("新建产品成功","success",1e3),setTimeout(function(){window.location.reload()},1e3)):IOT.tips(e.msg,"error",1e3)},error:function(e){console.log(e)}}),!1}return IOT.tips("请上传产品图片","error",1e3),!1}),$(".product-form-edit")[0]&&$(".product-form-edit").parsley().on("form:submit",function(){var e=$("#product-img").val(),o=$(".product-form-edit").attr("series");if(e){if("pump"==o)var t="/product/edit_pump";else{var t="/product/edit_seal",r=$("#product-struct-img").val();if(!r)return IOT.tips("请上传产品结构图图片","error",1e3),!1}var i=$(".product-form-edit").serialize();return $.ajax({type:"GET",url:t,data:i,dataType:"json",success:function(e){0==e.code?(IOT.tips("产品修改成功","success",1e3),setTimeout(function(){window.location.reload()},1e3)):IOT.tips(e.msg,"error",1e3)},error:function(e){console.log(e)}}),!1}return IOT.tips("请上传产品图片","error",1e3),!1})},imageUploader:function(e,o){$("#zyupload").zyUpload({width:"520px",height:"auto",itemWidth:"140px",itemHeight:"115px",url:e,fileType:["jpg","png"],fileSize:512e5,multiple:!0,dragDrop:!1,tailor:!1,del:!0,finishDel:!1,onSelect:function(e,o){},onDelete:function(e,o){},onSuccess:function(e,t){IOT.tips("图片上传成功","success",800),o&&"function"==typeof o&&o(t)},onFailure:function(e,o){IOT.tips("图片上传失败","error",800)},onComplete:function(e){}})}};e.init()});